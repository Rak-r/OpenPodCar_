<?xml version="1.0" ?>
<!-- =================================================================================== -->
<!-- |    This document was autogenerated by xacro from podcar.urdf.xacro              | -->
<!-- |    EDITING THIS FILE BY HAND IS NOT RECOMMENDED                                 | -->
<!-- =================================================================================== -->
<robot name="podcar" xmlns:xacro="http://www.ros.org/wiki/xacro">
  
  <link name="base_link">
    <inertial>
      <mass value="33.855"/>
      <origin rpy=" 0 0 0" xyz="-0.0856132 -0.000839955 0.238145"/>
      <inertia ixx="2.2343" ixy="-0.023642" ixz="0.275174" iyy="3.42518" iyz="0.00239624" izz="2.1241"/>
    </inertial>
    <collision>
      <origin rpy=" 0 0 0" xyz="0 0 0.25"/>
      <geometry>
        <box size="1.6 0.73 0.1"/>
      </geometry>
    </collision>
    <visual>
      <origin rpy="0 0 1.57079" xyz="0 0 0"/>
      <geometry>
        <mesh filename="file://$(find pod2_description)/meshes/podcarv3.dae" scale="1 1 1"/>
        <!-- <scale>65 69 69</scale> -->
      </geometry>
    </visual>
  </link>
  <gazebo reference="base_link">
    <turnGravityOff>true</turnGravityOff>
  </gazebo>
  <gazebo reference="back_left_wheel">
    <turnGravityOff>true</turnGravityOff>
  </gazebo>
  <gazebo reference="back_right_wheel">
    <turnGravityOff>true</turnGravityOff>
  </gazebo>
  <gazebo reference="front_left_wheel">
    <turnGravityOff>true</turnGravityOff>
  </gazebo>
  <gazebo reference="front_right_wheel">
    <turnGravityOff>true</turnGravityOff>
  </gazebo>
  <gazebo reference="trackingrod">
    <turnGravityOff>true</turnGravityOff>
  </gazebo>
  <gazebo reference="front_left_pivot">
    <turnGravityOff>true</turnGravityOff>
  </gazebo>
  <gazebo reference="front_right_pivot">
    <turnGravityOff>true</turnGravityOff>
  </gazebo>
  <gazebo reference="base_link">
    <material>Gazebo/Blue</material>
  </gazebo>
  <gazebo reference="front_left_wheel">
    <mu1 value="0.5"/>
    <mu2 value="10"/>
    <slip1 value="0.01"/>
    <slip2 value="0.001"/>
    <minDepth>0.005</minDepth>
    <kp>1e8</kp>
    <material>Gazebo/Black</material>
  </gazebo>
  <gazebo reference="front_right_wheel">
    <mu1 value="0.5"/>
    <mu2 value="10"/>
    <slip1 value="0.01"/>
    <slip2 value="0.001"/>
    <minDepth>0.005</minDepth>
    <kp>1e8</kp>
    <material>Gazebo/Black</material>
  </gazebo>
  <gazebo reference="back_left_wheel">
    <mu1 value="10"/>
    <mu2 value="1"/>
    <slip1 value="0.0"/>
    <slip2 value="0.0"/>
    <minDepth>0.005</minDepth>
    <kp>1e8</kp>
    <material>Gazebo/Black</material>
  </gazebo>
  <gazebo reference="back_right_wheel">
    <mu1 value="10"/>
    <mu2 value="1"/>
    <slip1 value="0.0"/>
    <slip2 value="0.0"/>
    <minDepth>0.005</minDepth>
    <kp>1e8</kp>
    <material>Gazebo/Black</material>
  </gazebo>
  <!-- Wheels of the podcar --> 
  <link name="front_left_wheel">
    <origin xyz="0.6 0.285475 0.0" rpy="0 0 0"/>
    <inertial>
      <mass value="2.6357"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0246688" ixy="0.0" ixz="0.0" iyy="0.0246688" iyz="0.0" izz="0.0441058"/>
    </inertial>
    <collision name="front_left_wheel_collision">
      <origin xyz="0 0 0" rpy="-1.5707 0 0"/>
      <geometry>
        <cylinder length="0.1143" radius="0.17775"/>
      </geometry>
    </collision>
    <visual>
      <origin xyz="0 0 0" rpy="-3.14159 0 0"/>
      <geometry>
        <mesh filename="file://$(find pod2_description)/meshes/wheel.stl"/>
      </geometry>
      
    </visual>
  </link>
  <link name="front_right_wheel">
    <origin xyz="0.6 -0.285475 0.0" rpy="0 0 0"/>
    <inertial>
      <mass value="2.6357"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0246688" ixy="0.0" ixz="0.0" iyy="0.0246688" iyz="0.0" izz="0.0441058"/>
    </inertial>
    <collision name="front_right_wheel_collision">
      <origin xyz="0 0 0" rpy="-1.5707 0 0"/>
      <geometry>
        <cylinder length="0.1143" radius="0.17775"/>
      </geometry>
    </collision>
    <visual>
      <origin xyz="0 0 0" rpy="-3.14159 0 0"/>
      <geometry>
        <mesh filename="file://$(find pod2_description)/meshes/wheel.stl"/>
      </geometry> 
    </visual>
  </link>
  <link name="back_left_wheel">
    <origin xyz="-0.6 0.285475 0.0" rpy="0 0 0"/>
    <inertial>
      <mass value="2.6357"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0246688" ixy="0.0" ixz="0.0" iyy="0.0246688" iyz="0.0" izz="0.0441058"/>
    </inertial>
    <collision name="back_left_wheel_collision">
      <origin xyz="0 0 0" rpy="-1.5707 0 0"/>
      <geometry>
        <cylinder length="0.1143" radius="0.17775"/>
      </geometry>
    </collision>
    <visual>
      <origin xyz="0 0 0" rpy="-3.14159 0 0"/>
      <geometry>
        <mesh filename="file://$(find pod2_description)/meshes/wheel.stl"/>
      </geometry> 
    </visual>
  </link>
  <link name="back_right_wheel">
    <origin xyz="-0.6 -0.285475 0.0" rpy="0 0 0"/>
    <inertial>
      <mass value="2.6357"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia ixx="0.0246688" ixy="0.0" ixz="0.0" iyy="0.0246688" iyz="0.0" izz="0.0441058"/>
    </inertial>
    <collision name="back_right_wheel_collision">
      <origin xyz="0 0 0" rpy="-1.5707 0 0"/>
      <geometry>
        <cylinder length="0.1143" radius="0.17775"/>
      </geometry>
    </collision>
    <visual>
      <origin xyz="0 0 0" rpy="-3.14159 0 0"/>
      <geometry>
        <mesh filename="file://$(find pod2_description)/meshes/wheel.stl"/>
      </geometry> 
    </visual>
  </link>
  <!--Pivot links of the wheels with tracking rod as the parent link --> 
  <link name="front_left_pivot">
    <origin xyz="0.6 0.285475 0.0" rpy="0 0 0"/>
    <inertial>
      <mass value="2.6357"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0246688" ixy="0.0" ixz="0.0" iyy="0.0246688" iyz="0.0" izz="0.0441058"/>
    </inertial>
  </link>
  <link name="front_right_pivot">
    <origin xyz="0.6 -0.285475 0.0" rpy="0 0 0"/>
    <inertial>
      <mass value="2.6357"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0246688" ixy="0.0" ixz="0.0" iyy="0.0246688" iyz="0.0" izz="0.0441058"/>
    </inertial>
  </link>
  
  <!-- Adding velodyne VLP-16 sensor -->
  <joint name="velodyne_base_mount_joint" type="fixed">
    <origin rpy="0 0 0" xyz="-0.34 0 1.75"/>
    <parent link="base_link"/>
    <child link="velodyne_base_link"/>
  </joint>
  <link name="velodyne_base_link">
    <inertial>
      <mass value="0.83"/>
      <origin xyz="-0.34 0.26 1.75"/>
      <inertia ixx="0.000908059425" ixy="0" ixz="0" iyy="0.000908059425" iyz="0" izz="0.0011049624"/>
    </inertial>
    <visual>
      <geometry>
        <mesh filename="file://$(find pod2_description)/meshes/VLP16_base_1.dae"/>
      </geometry>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0.03"/>
      <geometry>
        <cylinder length="0.0717" radius="0.0516"/>
      </geometry>
    </collision>
  </link>
  <joint name="velodyne_base_scan_joint" type="fixed">
    <origin rpy="0 0 0" xyz="0 0 0.03"/>
    <parent link="velodyne_base_link"/>
    <child link="velodyne"/>
  </joint>
  <link name="velodyne">
    <inertial>
      <mass value="0.01"/>
      <origin xyz="0 0 0.03"/>
      <inertia ixx="1e-7" ixy="0" ixz="0" iyy="1e-7" iyz="0" izz="1e-7"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0.03"/>
      <geometry>
        <mesh filename="file://$(find pod2_description)/meshes/VLP16_scan.dae"/>
      </geometry>
    </visual>
  </link> 
  <gazebo reference="velodyne">
    <sensor name="lidar_sensor" type="ray">
      <pose>0 0 0 0 0 0</pose>
      <visualize>false</visualize>
      <update_rate>10</update_rate>
      <ray>
        <scan>
          <horizontal>
            <samples>1875</samples>
            <resolution>1</resolution>
            <min_angle>-3.14159265359</min_angle>
            <max_angle>3.14159265359</max_angle>
          </horizontal>
          <vertical>
            <samples>16</samples>
            <resolution>1</resolution>
            <min_angle>-0.261799387799</min_angle>
            <max_angle> 0.261799387799</max_angle>
          </vertical>
        </scan>
        <range>
          <min>0.3</min>
          <max>131.0</max>
          <resolution>0.001</resolution>
        </range>
        <noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.0</stddev>
        </noise>
      </ray>
      <plugin filename="libgazebo_ros_laser.so" name="gazebo_ros_laser">
        <topicName>/points_raw</topicName>
        <frameName>velodyne</frameName>
        <min_range>0.9</min_range>
        <max_range>130.0</max_range>
        <gaussianNoise>0.008</gaussianNoise>
      </plugin>
    </sensor>
  </gazebo> 
  <!-- Adding joints for the wheels. Rear wheels are connected with the base link while the front wheels are connected to the tracking rod which is the child link for the parent base link -->
  <joint name="back_left_wheel_joint" type="revolute">
    <parent link="base_link"/>
    <child link="back_left_wheel"/>
    <origin rpy="0 0 0" xyz="-0.6 0.4 0"/>
    <axis xyz="0 1 0"/>
    <limit effort="500000" lower="-0.785398" upper="0.785398" velocity="250"/>
  </joint>
  <joint name="back_right_wheel_joint" type="revolute">
    <parent link="base_link"/>
    <child link="back_right_wheel"/>
    <origin rpy="0 0 0" xyz="-0.6 -0.4 0"/>
    <axis xyz="0 1 0"/>
    <limit effort="500000" lower="-0.785398" upper="0.785398" velocity="250"/>
  </joint>
  <!--<joint name="front_left_pivot_joint" type="revolute">
    <parent link="base_link"/>
    <child link="front_left_pivot"/>
    <origin rpy="0 0 0" xyz="0.6 0.4 0"/>
    <axis xyz="0 0 1"/>
    <limit effort="500000" lower="-0.785398" upper="0.785398" velocity="250"/>
  </joint> -->
  <joint name="front_left_wheel_joint" type="revolute">
    <parent link="front_left_pivot"/>
    <child link="front_left_wheel"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit effort="500000" lower="-0.785398" upper="0.785398" velocity="250"/>
  </joint>
  <!--<joint name="front_right_pivot_joint" type="revolute">
    <parent link="base_link"/>
    <child link="front_right_pivot"/>
    <origin rpy="0 0 0" xyz="0.6 -0.4 0"/>
    <axis xyz="0 0 1"/>
    <limit effort="500000" lower="-0.785398" upper="0.785398" velocity="250"/>
  </joint> -->
  <joint name="front_right_wheel_joint" type="revolute">
    <parent link="front_right_pivot"/>
    <child link="front_right_wheel"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit effort="500000" lower="-0.785398" upper="0.785398" velocity="250"/>
  </joint>
  <!-- Parent link for tracking rod is set to base_link because of the Robot state publisher error: Found two root links [base_footprint] and [tracking rod] -->
  <joint name="trackingrod_joint" type="revolute">
    <origin rpy="0.0 0 0" xyz="0.6 0 0"/>
    <parent link="base_link"/>
    <child link="trackingrod"/>
    <limit effort="100" lower="-0.82393858467" upper="0.82393858467" velocity="250"/>
  </joint>
  <link name="trackingrod">
    <origin xyz="0.5 0 0.0" rpy="0 0 0"/>
    <inertial>
      <mass value="2.6357"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0246688" ixy="0.0" ixz="0.0" iyy="0.0246688" iyz="0.0" izz="0.0441058"/>
    </inertial>
    <visual name="trackingrod_visual">
      <origin xyz="0 0 0" rpy="0 0 0 "/>
      <geometry>
        <box size="0.1 0.7 0.1"/>
      </geometry>
    </visual>
  </link>
  <joint name="tracking_left_pivot_joint" type="revolute">
    <parent link="trackingrod"/>
    <child link="front_left_pivot"/>
    <origin rpy="0 0 0.0" xyz="0 0.4 0"/>
    <axis xyz="0 0 1"/>
    <limit effort="500000" lower="-0.785398" upper="0.785398" velocity="250"/>
  </joint>
  <joint name="tracking_right_pivot_joint" type="revolute">
    <parent link="trackingrod"/>
    <child link="front_right_pivot"/>
    <origin rpy="0 0 0.0" xyz="0 -0.4 0"/>
    <axis xyz="0 0 1"/>
    <limit effort="500000" lower="-0.785398" upper="0.785398" velocity="250"/>
  </joint>
  
  <gazebo>
    <plugin name='ackermann_drive' filename='libgazebo_ros_ackermann_drive.so'>

        <ros>
          <namespace>podcar</namespace>
          <remapping>cmd_vel:=cmd_vel</remapping>
          <remapping>odom:=odom</remapping>
          <remapping>distance:=distance</remapping>
        </ros>

        <update_rate>100.0</update_rate>

        <!-- wheels -->
        <front_left_joint>front_left_wheel_joint</front_left_joint>
        <front_right_joint>front_right_wheel_joint</front_right_joint>
        <rear_left_joint>back_left_wheel_joint</rear_left_joint>
        <rear_right_joint>back_right_wheel_joint</rear_right_joint>
        <left_steering_joint>tracking_left_pivot_joint</left_steering_joint>
        <right_steering_joint>tracking_right_pivot_joint</right_steering_joint>
        <steering_wheel_joint>trackingrod_joint</steering_wheel_joint>


        <!-- Max absolute steer angle for tyre in radians-->
        <!-- Any cmd_vel angular z greater than this would be capped -->
        <max_steer>0.85</max_steer>

        <!-- Max absolute steering angle of steering wheel -->
        <!-- Max absolute steering angle of steering wheel -->
        <max_steering_angle>7.85</max_steering_angle>

        <!-- Max absolute linear speed in m/s -->
        <max_speed>22</max_speed>

        <!-- PID tuning -->
        <left_steering_pid_gain>4000 0 1</left_steering_pid_gain>
        <left_steering_i_range>0 0</left_steering_i_range>
        <right_steering_pid_gain>4000 0 1</right_steering_pid_gain>
        <right_steering_i_range>0 0</right_steering_i_range>
        <linear_velocity_pid_gain>4000 0 1</linear_velocity_pid_gain>
        <linear_velocity_i_range>0 0</linear_velocity_i_range>

        <!-- output -->
        <publish_odom>true</publish_odom>
        <publish_odom_tf>true</publish_odom_tf>
        <publish_wheel_tf>true</publish_wheel_tf>
        <publish_distance>true</publish_distance>

        <odometry_frame>odom</odometry_frame>
        <robot_base_frame>base_link</robot_base_frame>

    </plugin>
  </gazebo>
  <gazebo>
    <plugin filename="libgazebo_ros_joint_state_publisher.so" name="gazebo_joint_state_publisher">
      <robotNamespace>/podcar</robotNamespace>
      <joint_name>trackingrod_joint</joint_name>
      <joint_name>tracking_left_pivot_joint</joint_name>
      <joint_name>tracking_right_pivot_joint</joint_name>
      <joint_name>velodyne_base_mount_joint</joint_name>
      <joint_name>velodyne_base_scan_joint</joint_name> 
      <joint_name>front_left_wheel_joint</joint_name>
      <joint_name>front_right_wheel_joint</joint_name> 
      <joint_name>back_left_wheel_joint</joint_name>
      <joint_name>back_right_wheel_joint</joint_name>
      <updateRate>100.0</updateRate>
      <alwaysOn>true</alwaysOn>
    </plugin>
  </gazebo> 
</robot>

